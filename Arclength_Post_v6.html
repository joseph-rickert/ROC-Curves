<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Joseph Rickert">
<meta name="dcterms.date" content="2025-12-02">

<title>ROC Curves, Arc Length, and Differential Geometry</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Arclength_Post_v6_files/libs/clipboard/clipboard.min.js"></script>
<script src="Arclength_Post_v6_files/libs/quarto-html/quarto.js"></script>
<script src="Arclength_Post_v6_files/libs/quarto-html/popper.min.js"></script>
<script src="Arclength_Post_v6_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Arclength_Post_v6_files/libs/quarto-html/anchor.min.js"></script>
<link href="Arclength_Post_v6_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Arclength_Post_v6_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Arclength_Post_v6_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Arclength_Post_v6_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Arclength_Post_v6_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">ROC Curves, Arc Length, and Differential Geometry</h1>
<p class="subtitle lead">A mathematical take on ROC curves</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Joseph Rickert </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 2, 2025</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<p>This post attempts to make the case that basic concepts from differential geometry could be helpful for analyzing ROC curves. None of this is either particularly difficult or profound, but it involves a little more mathematics than most machine learning analyses attempt. The fundamental insight is that using ideas from functional analysis to smooth ROC curves produces functional objects, smoothed curves that can be studied with calculus. This approach should be helpful for most of ROC curves that you are likely to find in the wild.</p>
<p>The first insight from differential geometry comes from realizing that it is meaningful to compute arc length for smooth ROC curves. Arc length is not a useful concept for the stair-step like ROC curves since any curve that goes from (0,0) to (1,1) will have a length of 2. However for smooth ROC curves, arc length is a viable alternative to AUC for comparing multiple curves.</p>
<div class="cell">
<details>
<summary>Show the packages required</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels) <span class="co"># For modeling and evaluation</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)    <span class="co"># For data manipulation</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)  <span class="co"># For plotting</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS) <span class="co"># for Pima.tr</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlbench) <span class="co"># for data</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)  <span class="co"># For ROC curve analysis</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)   <span class="co"># For tables)</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(katex) <span class="co"># For rendering math)</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">tidymodels_prefer</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="the-data" class="level2">
<h2 class="anchored" data-anchor-id="the-data">The Data</h2>
<p>Rather than only using synthetic data, I thought that the ideas in the post would make more of a positive impression if they were illustrated with small familiar data sets. So in addition to the <code>two_class_dat</code> artificial data set from the the <code>modeldata</code> package, I have included <code>Pima.tr</code> from the <code>MASS</code> package and a subset of the <code>aSAH</code> data set from the <code>pROC</code> package. I have selected just two numeric features from each data set in order to process the with a single, minimal <code>tidymodels</code> workflow.</p>
<p>The next section of code prepares these three data sets for processing. I am only going to use the <code>aSAH2</code> data set in the rest of the post, but you can easily switch to one of the other two data sets by changing a single line of code. I admit that this is a minimal effort on my part to show you that the ideas in this post are broadly applicable, but I hope it is sufficient to whet your appetite for running the code o your own data.</p>
<div class="cell">
<details>
<summary>Look at the available data sets</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load a sample dataset (e.g., `two_class_dat` from `modeldata`)</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(two_class_dat, <span class="at">package =</span> <span class="st">"modeldata"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>two_class_dat2 <span class="ot">&lt;-</span> two_class_dat <span class="sc">%&gt;%</span>  <span class="fu">mutate</span>(<span class="at">Class =</span> <span class="fu">recode</span>(Class,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"Class1"</span> <span class="ot">=</span> <span class="st">"1"</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"Class2"</span> <span class="ot">=</span> <span class="st">"2"</span>))</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Pima.tr, <span class="at">package =</span> <span class="st">"MASS"</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>Pima.tr2 <span class="ot">&lt;-</span> Pima.tr <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>                              <span class="at">Class =</span> type,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>                              <span class="at">Class =</span> <span class="fu">recode</span>(Class,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Yes"</span> <span class="ot">=</span> <span class="st">"2"</span>,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"No"</span> <span class="ot">=</span> <span class="st">"1"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">select</span>(<span class="fu">c</span>(bmi,bp,Class))</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(aSAH, <span class="at">package =</span> <span class="st">"pROC"</span>)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>aSAH2 <span class="ot">&lt;-</span> aSAH <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>                              <span class="at">Class =</span> outcome,</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>                              <span class="at">Class =</span> <span class="fu">recode</span>(Class,</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Good"</span> <span class="ot">=</span> <span class="st">"1"</span>,</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Poor"</span> <span class="ot">=</span> <span class="st">"2"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">select</span>(<span class="fu">c</span>(s100b,ndka,Class))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>This is the section where you can select which data set to explore by un-commenting the assignment to df that corresponds to the data set you want. Any one you choose will have two numeric features and a class label column <code>Class</code>.</p>
<div class="cell">
<details>
<summary>Look here to select a data set</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set a seed for reproducibility</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Select a data set</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">#df&lt;- two_class_dat2 # try FPC = 1, FNC = 10</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">#df &lt;- Pima.tr2 # try FPC = 10 , FNC = 1</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> aSAH2 <span class="co">#try FPC = 1, FNC = 1</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   s100b  ndka Class
29  0.13  3.01     1
30  0.14  8.54     1
31  0.10  8.09     1
32  0.04 10.42     1
33  0.13 17.40     2
34  0.10 12.75     2</code></pre>
</div>
<details>
<summary>Look here to select a data set</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the data into training and testing sets</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>data_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(df, <span class="at">prop =</span> <span class="fl">0.75</span>, <span class="at">strata =</span> Class)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> <span class="fu">training</span>(data_split)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> <span class="fu">testing</span>(data_split)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="the-classifiers" class="level2">
<h2 class="anchored" data-anchor-id="the-classifiers">The Classifiers</h2>
<p>The workflows use three classifiers to fit the models: logistic regression, SVM, and decision tree.</p>
<div class="cell">
<details>
<summary>Show the workflow code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the models</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Logistic Regression</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>log_reg_spec <span class="ot">&lt;-</span> <span class="fu">logistic_reg</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Support Vector Machine (SVM)</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>svm_spec <span class="ot">&lt;-</span> <span class="fu">svm_linear</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"kernlab"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Decision Tree</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>tree_spec <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"rpart"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Create workflows for each model</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>log_reg_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(log_reg_spec) <span class="sc">%&gt;%</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_formula</span>(Class <span class="sc">~</span> .)</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>svm_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(svm_spec) <span class="sc">%&gt;%</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_formula</span>(Class <span class="sc">~</span> .)</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>tree_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(tree_spec) <span class="sc">%&gt;%</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_formula</span>(Class <span class="sc">~</span> .)</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the models to the training data</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>log_reg_fit <span class="ot">&lt;-</span> <span class="fu">fit</span>(log_reg_wf, <span class="at">data =</span> train_data)</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>svm_fit <span class="ot">&lt;-</span> <span class="fu">fit</span>(svm_wf, <span class="at">data =</span> train_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> Setting default kernel parameters  </code></pre>
</div>
<details>
<summary>Show the workflow code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>tree_fit <span class="ot">&lt;-</span> <span class="fu">fit</span>(tree_wf, <span class="at">data =</span> train_data)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect predictions for each model on the test data</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>log_reg_preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(log_reg_fit, <span class="at">new_data =</span> test_data, <span class="at">type =</span> <span class="st">"prob"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(test_data <span class="sc">%&gt;%</span> <span class="fu">select</span>(Class)) <span class="sc">%&gt;%</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">"Logistic Regression"</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>svm_preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(svm_fit, <span class="at">new_data =</span> test_data, <span class="at">type =</span> <span class="st">"prob"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(test_data <span class="sc">%&gt;%</span> <span class="fu">select</span>(Class)) <span class="sc">%&gt;%</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">"SVM"</span>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>tree_preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(tree_fit, <span class="at">new_data =</span> test_data, <span class="at">type =</span> <span class="st">"prob"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(test_data <span class="sc">%&gt;%</span> <span class="fu">select</span>(Class)) <span class="sc">%&gt;%</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">"Decision Tree"</span>)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute AUCs and relabel models with AUC values</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>auc_tree <span class="ot">&lt;-</span> <span class="fu">roc_auc</span>(tree_preds, <span class="at">truth =</span> Class, .pred_1)<span class="sc">$</span>.estimate</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>auc_svm <span class="ot">&lt;-</span> <span class="fu">roc_auc</span>(svm_preds, <span class="at">truth =</span> Class, .pred_1)<span class="sc">$</span>.estimate</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>auc_log_reg <span class="ot">&lt;-</span> <span class="fu">roc_auc</span>(log_reg_preds, <span class="at">truth =</span> Class, .pred_1)<span class="sc">$</span>.estimate</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Update model labels to include AUC</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>log_reg_preds <span class="ot">&lt;-</span> log_reg_preds <span class="sc">%&gt;%</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">paste0</span>(<span class="st">"Logistic Regression (AUC = "</span>, <span class="fu">round</span>(auc_log_reg, <span class="dv">3</span>), <span class="st">")"</span>))</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>svm_preds <span class="ot">&lt;-</span> svm_preds <span class="sc">%&gt;%</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">paste0</span>(<span class="st">"SVM (AUC = "</span>, <span class="fu">round</span>(auc_svm, <span class="dv">3</span>), <span class="st">")"</span>))</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>tree_preds <span class="ot">&lt;-</span> tree_preds <span class="sc">%&gt;%</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">paste0</span>(<span class="st">"Decision Tree (AUC = "</span>, <span class="fu">round</span>(auc_tree, <span class="dv">3</span>), <span class="st">")"</span>))</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine predictions with updated labels</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>all_preds <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(log_reg_preds, svm_preds, tree_preds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>This section of code fits the models, computes AUC for each model, and plots the basic ROC curves.</p>
<div class="cell">
<details>
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Plot the ROC Curves</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a> all_preds <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(model) <span class="sc">%&gt;%</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">roc_curve</span>(<span class="at">truth =</span> Class, .pred_1) <span class="sc">%&gt;%</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"ROC Curves for Multiple Classifiers"</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Model"</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Arclength_Post_v6_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a copy of all_preds with cleaned model names</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>all_preds_2 <span class="ot">&lt;-</span> all_preds <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">model_AUC =</span> model,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">model=</span> <span class="fu">sub</span>(<span class="st">" </span><span class="sc">\\</span><span class="st">(AUC.*$"</span>, <span class="st">""</span>, model_AUC))</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute ROC data for each model</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>roc_data <span class="ot">&lt;-</span> all_preds_2 <span class="sc">%&gt;%</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(model) <span class="sc">%&gt;%</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">roc_curve</span>(<span class="at">truth =</span> Class, .pred_1)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute AUC for each model</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>auc_data <span class="ot">&lt;-</span> all_preds_2 <span class="sc">%&gt;%</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(model) <span class="sc">%&gt;%</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">roc_auc</span>(<span class="at">truth =</span> Class, .pred_1)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect actual model names</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co">#print(unique(roc_data$model))</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Build legend labels with AUC</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>legend_labels <span class="ot">&lt;-</span> <span class="fu">paste0</span>(auc_data<span class="sc">$</span>model,</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>                        <span class="st">" (AUC = "</span>, <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, auc_data<span class="sc">$</span>.estimate), <span class="st">")"</span>)</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="co"># IMPORTANT: match colors to the actual values in your data</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace the strings below with the exact output from unique(roc_data$model)</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>color_values <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Logistic Regression"</span> <span class="ot">=</span> <span class="st">"#1b9e77"</span>,</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SVM"</span>                 <span class="ot">=</span> <span class="st">"#7570b3"</span>,</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Decision Tree"</span>       <span class="ot">=</span> <span class="st">"#d95f02"</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure model is a factor with levels matching auc_data$model</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>roc_data <span class="ot">&lt;-</span> roc_data <span class="sc">%&gt;%</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">factor</span>(model, <span class="at">levels =</span> auc_data<span class="sc">$</span>model))</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a><span class="co"># An alternative plot with more elaborate formating.</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot raw step-function ROC curves</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a><span class="co">#gplot(roc_data, aes(x = 1 - specificity, y = sensitivity, color = model)) +</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_path(size = 1.4) +</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_abline(slope = 1, intercept = 0, linetype = "dashed", color = "grey50") +</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># coord_fixed(ratio = 1, xlim = c(0,1), ylim = c(0,1), expand = FALSE) +</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># labs(title = "ROC Curves for Multiple Classifiers",</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>  <span class="co">#      x = "False Positive Rate (FPR)",</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>  <span class="co">#      y = "True Positive Rate (TPR)",</span></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>  <span class="co">#      color = NULL) +</span></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_color_manual(values = color_values, labels = legend_labels) +</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># #theme_classic() +</span></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># theme(</span></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   legend.position = c(0.65, 0.25),</span></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   legend.text = element_text(size = 9, lineheight = 1.1),</span></span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   legend.background = element_rect(fill = alpha("white", 0.7), color = NA),</span></span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   plot.margin = margin(20, 20, 20, 20)</span></span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>  <span class="co"># )</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="smooth-roc-curves-and-arc-length" class="level2">
<h2 class="anchored" data-anchor-id="smooth-roc-curves-and-arc-length">Smooth ROC Curves and Arc Length</h2>
<p>In this section a spline bases is used to construct smoothed curves. AUC is computed for both raw and smoothed ROC curves. Arc length is only computed for the smoothed curves. The comments in the code provide some technical details about the methods used.</p>
<div class="cell">
<details>
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> all_preds</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Numerical integration using the trapezoidal rule</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>trapz <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>((y[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">+</span> y[<span class="sc">-</span><span class="fu">length</span>(y)]) <span class="sc">/</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">diff</span>(x))</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute discrete ROC points from predictions</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>discrete_roc <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  roc_obj <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="at">response =</span> df<span class="sc">$</span>Class,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">predictor =</span> df<span class="sc">$</span>.pred_1,</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"2"</span>,<span class="st">"1"</span>),   <span class="co"># control first, positive second</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">direction =</span> <span class="st">"&lt;"</span>)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  rc <span class="ot">&lt;-</span> <span class="fu">coords</span>(roc_obj, <span class="st">"all"</span>, <span class="at">ret =</span> <span class="fu">c</span>(<span class="st">"specificity"</span>,<span class="st">"sensitivity"</span>), <span class="at">transpose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  FPR <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> rc<span class="sc">$</span>specificity</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  TPR <span class="ot">&lt;-</span> rc<span class="sc">$</span>sensitivity</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  FPR <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, FPR, <span class="dv">1</span>)</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  TPR <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, TPR, <span class="dv">1</span>)</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  ord <span class="ot">&lt;-</span> <span class="fu">order</span>(FPR, TPR)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>  FPR <span class="ot">&lt;-</span> FPR[ord]</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>  TPR <span class="ot">&lt;-</span> <span class="fu">cummax</span>(TPR[ord])   <span class="co"># enforce monotonicity</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">FPR =</span> FPR, <span class="at">TPR =</span> TPR)</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="co">#   smooth_roc takes raw ROC points (FPR, TPR) and produces a smoothed ROC curve with:</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="co">#      A monotone spline interpolation of TPR vs. FPR</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a><span class="co">#.     A dense grid of points (n = 400 by default)</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a><span class="co">#.     Computed AUC (area under the curve)</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a><span class="co">#.     Computed arc length (geometric length of the ROC trajectory)</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a><span class="co">#.  It returns a tibble with the smoothed ROC coordinates and the two summary metrics.  </span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a><span class="co"># "monoH.FC" is a special option in R’s splinefun that stands for Monotone Hermite cubic spline (Fritsch–Carlson method).</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a><span class="co">#. It guarantees that the interpolated function is monotone increasing if the data are monotone.</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a><span class="co">#  Unlike ordinary cubic splines, which can overshoot and produce non‑monotone artifacts, </span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a><span class="co">#. "monoH.FC" preserves the monotonicity of ROC curves (TPR should not decrease as FPR increases).</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a><span class="co">#  The algorithm adjusts slopes at knots to prevent oscillations while keeping the interpolation smooth.</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a><span class="co">#  This matters for ROC curves because:</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a><span class="co">#.    ROC curves must be monotone (TPR should not decrease with increasing FPR).</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a><span class="co">#     "monoH.FC" ensures the smoothed curve respects this property and avoids unrealistic wiggles </span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a><span class="co">#.     that could distort AUC or arc length.</span></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>smooth_roc <span class="ot">&lt;-</span> <span class="cf">function</span>(FPR, TPR, <span class="at">n =</span> <span class="dv">400</span>) {</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">FPR =</span> FPR, <span class="at">TPR =</span> TPR) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(FPR) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(FPR, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>  mono_fun <span class="ot">&lt;-</span> <span class="fu">splinefun</span>(<span class="at">x =</span> df<span class="sc">$</span>FPR, <span class="at">y =</span> df<span class="sc">$</span>TPR, <span class="at">method =</span> <span class="st">"monoH.FC"</span>)</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> n)</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">pmin</span>(<span class="fu">pmax</span>(<span class="fu">mono_fun</span>(x), <span class="dv">0</span>), <span class="dv">1</span>)</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>  auc <span class="ot">&lt;-</span> <span class="fu">trapz</span>(x, y)</span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>  dy <span class="ot">&lt;-</span> <span class="fu">mono_fun</span>(x, <span class="at">deriv =</span> <span class="dv">1</span>)</span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>  arc <span class="ot">&lt;-</span> <span class="fu">trapz</span>(x, <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">+</span> dy<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">FPR =</span> x, <span class="at">TPR =</span> y, <span class="at">auc =</span> auc, <span class="at">arc =</span> arc)</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize model names</span></span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a> df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model_norm =</span> <span class="fu">sub</span>(<span class="st">" </span><span class="sc">\\</span><span class="st">(.*$"</span>, <span class="st">""</span>, model))</span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>smooth_results <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(model_norm) <span class="sc">%&gt;%</span></span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_modify</span>(<span class="sc">~</span> {</span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>    dr <span class="ot">&lt;-</span> <span class="fu">discrete_roc</span>(.x)</span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>    sr <span class="ot">&lt;-</span> <span class="fu">smooth_roc</span>(dr<span class="sc">$</span>FPR, dr<span class="sc">$</span>TPR, <span class="at">n =</span> <span class="dv">400</span>)</span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>    <span class="co">#sr %&gt;% mutate(model_norm = unique(.x$model_norm))</span></span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a>  }) <span class="sc">%&gt;%</span></span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>metrics <span class="ot">&lt;-</span> smooth_results <span class="sc">%&gt;%</span></span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(model_norm) <span class="sc">%&gt;%</span></span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">AUC =</span> <span class="fu">unique</span>(auc), <span class="at">Arc =</span> <span class="fu">unique</span>(arc), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>This bloc of code overlays the smoothed and raw ROC curves for each model and adds a legend with raw AUC, smoothed AUC, and arc length for each model.</p>
<div class="cell">
<details>
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># df_raw: columns .pred_1, .pred_2, Class, model</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># smooth_results: columns model_norm, FPR, TPR, auc, arc</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Normalize model names in the raw data so they match smooth_results$model_norm</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>df_raw <span class="ot">&lt;-</span> all_preds <span class="sc">%&gt;%</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model_norm =</span> <span class="fu">sub</span>(<span class="st">" </span><span class="sc">\\</span><span class="st">(.*$"</span>, <span class="st">""</span>, model))  <span class="co"># e.g., "Logistic Regression (AUC = ...)" -&gt; "Logistic Regression"</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Compute raw ROC coordinates and raw AUC per model</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>raw_results <span class="ot">&lt;-</span> df_raw <span class="sc">%&gt;%</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(model_norm) <span class="sc">%&gt;%</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_map</span>(<span class="sc">~</span>{</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    roc_obj <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="at">response =</span> .x<span class="sc">$</span>Class,</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>                   <span class="at">predictor =</span> .x<span class="sc">$</span>.pred_1,</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>                   <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"2"</span>,<span class="st">"1"</span>),</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>                   <span class="at">direction =</span> <span class="st">"&lt;"</span>)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    rc <span class="ot">&lt;-</span> <span class="fu">coords</span>(roc_obj, <span class="st">"all"</span>, <span class="at">ret =</span> <span class="fu">c</span>(<span class="st">"specificity"</span>,<span class="st">"sensitivity"</span>), <span class="at">transpose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    FPR <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> rc<span class="sc">$</span>specificity</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    TPR <span class="ot">&lt;-</span> rc<span class="sc">$</span>sensitivity</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># pad ends, order, enforce monotone TPR</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    FPR <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, FPR, <span class="dv">1</span>)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    TPR <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, TPR, <span class="dv">1</span>)</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    ord <span class="ot">&lt;-</span> <span class="fu">order</span>(FPR, TPR)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    FPR <span class="ot">&lt;-</span> FPR[ord]</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    TPR <span class="ot">&lt;-</span> <span class="fu">cummax</span>(TPR[ord])</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>    auc_raw <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">auc</span>(roc_obj))</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>    m <span class="ot">&lt;-</span> .y<span class="sc">$</span>model_norm[[<span class="dv">1</span>]]  <span class="co"># group label; safer than looking back into .x</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tibble</span>(</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">model_norm =</span> <span class="fu">rep</span>(m, <span class="fu">length</span>(FPR)),</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">FPR =</span> FPR,</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">TPR =</span> TPR,</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">auc_raw =</span> <span class="fu">rep</span>(auc_raw, <span class="fu">length</span>(FPR)),</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">curve_type =</span> <span class="fu">rep</span>(<span class="st">"raw"</span>, <span class="fu">length</span>(FPR))</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>  }) <span class="sc">%&gt;%</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>()</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Prepare smoothed results to match columns (add curve_type and placeholder auc_raw)</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>smooth_results_plot <span class="ot">&lt;-</span> smooth_results <span class="sc">%&gt;%</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">curve_type =</span> <span class="st">"smooth"</span>,</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">auc_raw =</span> <span class="cn">NA_real_</span>  <span class="co"># placeholder so bind_rows columns align</span></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) Combine raw + smooth results</span></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>roc_results <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(raw_results, smooth_results_plot)</span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a><span class="co"># 5) Build legend metrics: Raw AUC (from raw_results), Smooth AUC and Arc (from smooth_results)</span></span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>metrics_raw <span class="ot">&lt;-</span> raw_results <span class="sc">%&gt;%</span></span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(model_norm, auc_raw) <span class="sc">%&gt;%</span></span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">AUC_raw =</span> auc_raw)</span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>metrics_smooth <span class="ot">&lt;-</span> smooth_results <span class="sc">%&gt;%</span></span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(model_norm, auc, arc) <span class="sc">%&gt;%</span></span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">AUC_smooth =</span> auc, <span class="at">Arc =</span> arc)</span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>metrics <span class="ot">&lt;-</span> metrics_raw <span class="sc">%&gt;%</span></span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(metrics_smooth, <span class="at">by =</span> <span class="st">"model_norm"</span>)</span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a>legend_labels <span class="ot">&lt;-</span> <span class="fu">setNames</span>(</span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(metrics<span class="sc">$</span>model_norm,</span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a>         <span class="st">"</span><span class="sc">\n</span><span class="st">Raw AUC = "</span>, <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, metrics<span class="sc">$</span>AUC_raw),</span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a>         <span class="st">"</span><span class="sc">\n</span><span class="st">Smooth AUC = "</span>, <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, metrics<span class="sc">$</span>AUC_smooth),</span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a>         <span class="st">"</span><span class="sc">\n</span><span class="st">Arc = "</span>, <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, metrics<span class="sc">$</span>Arc)),</span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a>  metrics<span class="sc">$</span>model_norm</span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a><span class="co"># 6) Pastel colors (keep model association). Ensure names match smooth_results$model_norm exactly.</span></span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a>color_values <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Decision Tree"</span>        <span class="ot">=</span> <span class="st">"#fcae91"</span>,  <span class="co"># pastel red</span></span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Logistic Regression"</span>  <span class="ot">=</span> <span class="st">"#a1d99b"</span>,  <span class="co"># pastel green</span></span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SVM"</span>                  <span class="ot">=</span> <span class="st">"#9ecae1"</span>   <span class="co"># pastel blue</span></span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true" tabindex="-1"></a>legend_labels <span class="ot">&lt;-</span> <span class="fu">setNames</span>(</span>
<span id="cb12-81"><a href="#cb12-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(metrics<span class="sc">$</span>model_norm,</span>
<span id="cb12-82"><a href="#cb12-82" aria-hidden="true" tabindex="-1"></a>         <span class="st">"</span><span class="sc">\n</span><span class="st">Raw AUC = "</span>, <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, metrics<span class="sc">$</span>AUC_raw),</span>
<span id="cb12-83"><a href="#cb12-83" aria-hidden="true" tabindex="-1"></a>         <span class="st">" | Smooth AUC = "</span>, <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, metrics<span class="sc">$</span>AUC_smooth),</span>
<span id="cb12-84"><a href="#cb12-84" aria-hidden="true" tabindex="-1"></a>         <span class="st">"</span><span class="sc">\n</span><span class="st">Arc = "</span>, <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, metrics<span class="sc">$</span>Arc),</span>
<span id="cb12-85"><a href="#cb12-85" aria-hidden="true" tabindex="-1"></a>         <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>),   <span class="co"># blank line between models</span></span>
<span id="cb12-86"><a href="#cb12-86" aria-hidden="true" tabindex="-1"></a>  metrics<span class="sc">$</span>model_norm</span>
<span id="cb12-87"><a href="#cb12-87" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-88"><a href="#cb12-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-89"><a href="#cb12-89" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(roc_results, <span class="fu">aes</span>(<span class="at">x=</span>FPR, <span class="at">y=</span>TPR,</span>
<span id="cb12-90"><a href="#cb12-90" aria-hidden="true" tabindex="-1"></a>                        <span class="at">color=</span>model_norm,</span>
<span id="cb12-91"><a href="#cb12-91" aria-hidden="true" tabindex="-1"></a>                        <span class="at">linetype=</span>curve_type)) <span class="sc">+</span></span>
<span id="cb12-92"><a href="#cb12-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb12-93"><a href="#cb12-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope=</span><span class="dv">1</span>, <span class="at">intercept=</span><span class="dv">0</span>,</span>
<span id="cb12-94"><a href="#cb12-94" aria-hidden="true" tabindex="-1"></a>              <span class="at">linetype=</span><span class="st">"dashed"</span>, <span class="at">color=</span><span class="st">"grey60"</span>) <span class="sc">+</span></span>
<span id="cb12-95"><a href="#cb12-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span>color_values, <span class="at">labels=</span>legend_labels) <span class="sc">+</span></span>
<span id="cb12-96"><a href="#cb12-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(</span>
<span id="cb12-97"><a href="#cb12-97" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"raw"</span><span class="ot">=</span><span class="st">"dashed"</span>, <span class="st">"smooth"</span><span class="ot">=</span><span class="st">"solid"</span>),</span>
<span id="cb12-98"><a href="#cb12-98" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"raw"</span><span class="ot">=</span><span class="st">"Raw ROC: dashed"</span>, <span class="st">"smooth"</span><span class="ot">=</span><span class="st">"Smoothed ROC: solid"</span>)</span>
<span id="cb12-99"><a href="#cb12-99" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb12-100"><a href="#cb12-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">expand=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb12-101"><a href="#cb12-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">expand=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb12-102"><a href="#cb12-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"ROC curves by model (raw vs smoothed)"</span>,</span>
<span id="cb12-103"><a href="#cb12-103" aria-hidden="true" tabindex="-1"></a>       <span class="at">x=</span><span class="st">"False Positive Rate"</span>,</span>
<span id="cb12-104"><a href="#cb12-104" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"True Positive Rate"</span>,</span>
<span id="cb12-105"><a href="#cb12-105" aria-hidden="true" tabindex="-1"></a>       <span class="at">color=</span><span class="cn">NULL</span>, <span class="at">linetype=</span><span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb12-106"><a href="#cb12-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(</span>
<span id="cb12-107"><a href="#cb12-107" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">order =</span> <span class="dv">1</span>, <span class="at">title =</span> <span class="cn">NULL</span>, <span class="at">label.theme =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>)),</span>
<span id="cb12-108"><a href="#cb12-108" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="fu">guide_legend</span>(<span class="at">order =</span> <span class="dv">2</span>, <span class="at">title =</span> <span class="cn">NULL</span>, <span class="at">label.theme =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>))</span>
<span id="cb12-109"><a href="#cb12-109" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb12-110"><a href="#cb12-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size=</span><span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb12-111"><a href="#cb12-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb12-112"><a href="#cb12-112" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">9</span>, <span class="at">face=</span><span class="st">"bold"</span>),</span>
<span id="cb12-113"><a href="#cb12-113" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>),</span>
<span id="cb12-114"><a href="#cb12-114" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text  =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">7</span>),</span>
<span id="cb12-115"><a href="#cb12-115" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.65</span>, <span class="fl">0.25</span>),   <span class="co"># inside plot, under diagonal</span></span>
<span id="cb12-116"><a href="#cb12-116" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">7</span>, <span class="at">lineheight=</span><span class="fl">1.2</span>),</span>
<span id="cb12-117"><a href="#cb12-117" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="fu">alpha</span>(<span class="st">"white"</span>, <span class="fl">0.8</span>), <span class="at">color =</span> <span class="cn">NA</span>),</span>
<span id="cb12-118"><a href="#cb12-118" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">"lines"</span>),</span>
<span id="cb12-119"><a href="#cb12-119" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb12-120"><a href="#cb12-120" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Arclength_Post_v6_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The first thing to observe that the smooth curves do not perfectly overlay the stair-step curves, as one might expect for curves with large steps. Nevertheless the AUC numbers are close, and in this case they preserve the order. Also note that selecting the curves passed on arc length would lead to the same results.</p>
<section id="the-case-for-arc-length" class="level3">
<h3 class="anchored" data-anchor-id="the-case-for-arc-length">The Case for Arc Length</h3>
<p>The main insight is that ROC curve is the direct representation of the conditional probability distribution relating True Positive Rate (TPR) and False Positive Rate (FPR). Each point (x,y) on the ROC curve yields the conditional distribution of TPR given the distribution of FPR. <span class="math inline">\(P(TPR \le y \mid FPR \le x)\)</span>. This to my mind a direct, clear,and as you will see below, useful probability statement. The area under the curve (AUC), on the other hand, is an indirect measure with the probability interpretation that is usually rendered something like the definition provided in <a href="https://en.wikipedia.org/wiki/Receiver_operating_characteristic#:~:text=The%20area%20under%20the%20curve,ranks%20higher%20than%20'negative'">wikipedia</a></p>
<blockquote class="blockquote">
<p>AUC is equal to the probability that a classifier will rank a randomly chosen positive instance higher than a randomly chosen negative one (assuming ‘positive’ ranks higher than ‘negative’).</p>
</blockquote>
<p>I always ask my self when would I want to perform this experiment, and never come up with a good answer. Also, I have never seen this probability invoked to clarify a practical analysis.</p>
<p>It is also the case that arc length is a linear measure while AUC is an area. I may very well be be wrong about this, but I think most people have a better intuition of the practical significance of a linear difference of 0.3 inches than an area difference of 0.3 square inches.</p>
<p>Arc length also mostly avoids the criticism of AUC that led to the development of <a href="https://en.wikipedia.org/wiki/Partial_Area_Under_the_ROC_Curve">Partial Arc length</a>. It is relatively easy to exclude segments of regions that are not important to the application. An unless the ROC curve pathelogically crosses the diagonal at FPR &gt; .5 and TPR &lt; .5 it will not be troubled region of <a href="https://en.wikipedia.org/wiki/Receiver_operating_characteristic#:~:text=The%20main%20criticism%20to%20the,the%20plot%20on%20the%20right.">low sensitivity and low specificity</a>.</p>
<p>Finally, arc length is directly related to the geometry of the ROC curve and as I hope to convince you below, some basic ideas of differential geometry may be useful in interpreting the behavior of ROC curves. The following table is as close as I can come to a fair comparison of the two metrics. I hope you find it useful, however, I despair of ever seeing a clinical practitioner abandoning AUC.</p>
</section>
<section id="table-comparing-arclength-with-auc" class="level3">
<h3 class="anchored" data-anchor-id="table-comparing-arclength-with-auc">Table Comparing Arclength with AUC</h3>
<div class="cell">
<details>
<summary>Show the code to build the table</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Data for table ---</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>tbl_data <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>Aspect, <span class="sc">~</span>AUC, <span class="sc">~</span>ArcLength,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Definition"</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"$</span><span class="sc">\\</span><span class="st">int_0^1 f(x)</span><span class="sc">\\</span><span class="st">,dx$"</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"$</span><span class="sc">\\</span><span class="st">int_0^1 </span><span class="sc">\\</span><span class="st">sqrt{1+(f'(x))^2}</span><span class="sc">\\</span><span class="st">,dx$"</span>,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Probabilistic meaning"</span>,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Probability that a randomly chosen positive is ranked above a randomly chosen negative"</span>,</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Probability that TPR ≤ y given FPR ≤ x (joint distribution along ROC trajectory)"</span>,</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Bounds"</span>,</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"0.5 (random) to 1.0 (perfect)"</span>,</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"$</span><span class="sc">\\</span><span class="st">sqrt{2} </span><span class="sc">\\</span><span class="st">approx 1.414$ (diagonal) to 2.0 (perfect staircase ROC)"</span>,</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Interpretability"</span>,</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Widely used, intuitive for clinicians; benchmarks exist (e.g., &gt;0.9 = excellent)"</span>,</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Linear measure, easier to visualize by eye; highlights curve geometry and trajectory"</span>,</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Sensitivity to curve shape"</span>,</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Less sensitive — curves with different shapes can yield similar AUC"</span>,</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">"More sensitive — captures slope changes, curvature, and smoothness differences"</span>,</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Partial evaluation"</span>,</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Partial AUC requires normalization; less visually obvious"</span>,</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">"It is easy to avoid problematic regions for most reasonable ROC curves"</span>,</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Noise robustness"</span>,</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Relatively robust; integrates over curve"</span>,</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>  <span class="st">"More sensitive to noise or jaggedness; small oscillations inflate length"</span>,</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Clinical adoption"</span>,</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Standard metric with established thresholds"</span>,</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Novel metric; not yet widely adopted, requires new benchmarks"</span>,</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Use cases"</span>,</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Ranking accuracy, overall discrimination power"</span>,</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Diagnostic trajectory, geometric comparison, highlighting regional performance differences"</span></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>gt_tbl <span class="ot">&lt;-</span> tbl_data <span class="sc">%&gt;%</span></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(<span class="at">title =</span> <span class="st">"Comparison of ROC Metrics: AUC vs. Arc Length"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(</span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">Aspect =</span> <span class="st">"Aspect"</span>,</span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">AUC =</span> <span class="st">"AUC (Area Under Curve)"</span>,</span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">ArcLength =</span> <span class="st">"Arc Length (ROC Curve Length)"</span></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_markdown</span>(<span class="at">columns =</span> <span class="fu">everything</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_options</span>(</span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">table.font.size =</span> <span class="fu">px</span>(<span class="dv">12</span>),   <span class="co"># smaller text</span></span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">data_row.padding =</span> <span class="fu">px</span>(<span class="dv">2</span>)    <span class="co"># tighter row spacing</span></span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>gt_tbl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="uhugtrqabq" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#uhugtrqabq table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#uhugtrqabq thead, #uhugtrqabq tbody, #uhugtrqabq tfoot, #uhugtrqabq tr, #uhugtrqabq td, #uhugtrqabq th {
  border-style: none;
}

#uhugtrqabq p {
  margin: 0;
  padding: 0;
}

#uhugtrqabq .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 12px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#uhugtrqabq .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#uhugtrqabq .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#uhugtrqabq .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#uhugtrqabq .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#uhugtrqabq .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#uhugtrqabq .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#uhugtrqabq .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#uhugtrqabq .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#uhugtrqabq .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#uhugtrqabq .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#uhugtrqabq .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#uhugtrqabq .gt_spanner_row {
  border-bottom-style: hidden;
}

#uhugtrqabq .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#uhugtrqabq .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#uhugtrqabq .gt_from_md > :first-child {
  margin-top: 0;
}

#uhugtrqabq .gt_from_md > :last-child {
  margin-bottom: 0;
}

#uhugtrqabq .gt_row {
  padding-top: 2px;
  padding-bottom: 2px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#uhugtrqabq .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#uhugtrqabq .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#uhugtrqabq .gt_row_group_first td {
  border-top-width: 2px;
}

#uhugtrqabq .gt_row_group_first th {
  border-top-width: 2px;
}

#uhugtrqabq .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#uhugtrqabq .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#uhugtrqabq .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#uhugtrqabq .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#uhugtrqabq .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#uhugtrqabq .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#uhugtrqabq .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#uhugtrqabq .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#uhugtrqabq .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#uhugtrqabq .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#uhugtrqabq .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#uhugtrqabq .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#uhugtrqabq .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#uhugtrqabq .gt_left {
  text-align: left;
}

#uhugtrqabq .gt_center {
  text-align: center;
}

#uhugtrqabq .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#uhugtrqabq .gt_font_normal {
  font-weight: normal;
}

#uhugtrqabq .gt_font_bold {
  font-weight: bold;
}

#uhugtrqabq .gt_font_italic {
  font-style: italic;
}

#uhugtrqabq .gt_super {
  font-size: 65%;
}

#uhugtrqabq .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#uhugtrqabq .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#uhugtrqabq .gt_indent_1 {
  text-indent: 5px;
}

#uhugtrqabq .gt_indent_2 {
  text-indent: 10px;
}

#uhugtrqabq .gt_indent_3 {
  text-indent: 15px;
}

#uhugtrqabq .gt_indent_4 {
  text-indent: 20px;
}

#uhugtrqabq .gt_indent_5 {
  text-indent: 25px;
}

#uhugtrqabq .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#uhugtrqabq div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_heading">
      <td colspan="3" class="gt_heading gt_title gt_font_normal gt_bottom_border" style="">Comparison of ROC Metrics: AUC vs. Arc Length</td>
    </tr>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Aspect">Aspect</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="AUC">AUC (Area Under Curve)</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="ArcLength">Arc Length (ROC Curve Length)</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="Aspect" class="gt_row gt_left"><span data-qmd-base64="RGVmaW5pdGlvbg=="><span class="gt_from_md">Definition</span></span></td>
<td headers="AUC" class="gt_row gt_left"><span data-qmd-base64="XChcaW50XzBeMSBmKHgpXCxkeFwp"><span class="gt_from_md">\(\int_0^1 f(x)\,dx\)</span></span></td>
<td headers="ArcLength" class="gt_row gt_left"><span data-qmd-base64="XChcaW50XzBeMSBcc3FydHsxKyhmJyh4KSleMn1cLGR4XCk="><span class="gt_from_md">\(\int_0^1 \sqrt{1+(f'(x))^2}\,dx\)</span></span></td></tr>
    <tr><td headers="Aspect" class="gt_row gt_left"><span data-qmd-base64="UHJvYmFiaWxpc3RpYyBtZWFuaW5n"><span class="gt_from_md">Probabilistic meaning</span></span></td>
<td headers="AUC" class="gt_row gt_left"><span data-qmd-base64="UHJvYmFiaWxpdHkgdGhhdCBhIHJhbmRvbWx5IGNob3NlbiBwb3NpdGl2ZSBpcyByYW5rZWQgYWJvdmUgYSByYW5kb21seSBjaG9zZW4gbmVnYXRpdmU="><span class="gt_from_md">Probability that a randomly chosen positive is ranked above a randomly chosen negative</span></span></td>
<td headers="ArcLength" class="gt_row gt_left"><span data-qmd-base64="UHJvYmFiaWxpdHkgdGhhdCBUUFIg4omkIHkgZ2l2ZW4gRlBSIOKJpCB4IChqb2ludCBkaXN0cmlidXRpb24gYWxvbmcgUk9DIHRyYWplY3Rvcnkp"><span class="gt_from_md">Probability that TPR ≤ y given FPR ≤ x (joint distribution along ROC trajectory)</span></span></td></tr>
    <tr><td headers="Aspect" class="gt_row gt_left"><span data-qmd-base64="Qm91bmRz"><span class="gt_from_md">Bounds</span></span></td>
<td headers="AUC" class="gt_row gt_left"><span data-qmd-base64="MC41IChyYW5kb20pIHRvIDEuMCAocGVyZmVjdCk="><span class="gt_from_md">0.5 (random) to 1.0 (perfect)</span></span></td>
<td headers="ArcLength" class="gt_row gt_left"><span data-qmd-base64="XChcc3FydHsyfSBcYXBwcm94IDEuNDE0XCkgKGRpYWdvbmFsKSB0byAyLjAgKHBlcmZlY3Qgc3RhaXJjYXNlIFJPQyk="><span class="gt_from_md">\(\sqrt{2} \approx 1.414\) (diagonal) to 2.0 (perfect staircase ROC)</span></span></td></tr>
    <tr><td headers="Aspect" class="gt_row gt_left"><span data-qmd-base64="SW50ZXJwcmV0YWJpbGl0eQ=="><span class="gt_from_md">Interpretability</span></span></td>
<td headers="AUC" class="gt_row gt_left"><span data-qmd-base64="V2lkZWx5IHVzZWQsIGludHVpdGl2ZSBmb3IgY2xpbmljaWFuczsgYmVuY2htYXJrcyBleGlzdCAoZS5nLiwgJmd0OzAuOSA9IGV4Y2VsbGVudCk="><span class="gt_from_md">Widely used, intuitive for clinicians; benchmarks exist (e.g., &gt;0.9 = excellent)</span></span></td>
<td headers="ArcLength" class="gt_row gt_left"><span data-qmd-base64="TGluZWFyIG1lYXN1cmUsIGVhc2llciB0byB2aXN1YWxpemUgYnkgZXllOyBoaWdobGlnaHRzIGN1cnZlIGdlb21ldHJ5IGFuZCB0cmFqZWN0b3J5"><span class="gt_from_md">Linear measure, easier to visualize by eye; highlights curve geometry and trajectory</span></span></td></tr>
    <tr><td headers="Aspect" class="gt_row gt_left"><span data-qmd-base64="U2Vuc2l0aXZpdHkgdG8gY3VydmUgc2hhcGU="><span class="gt_from_md">Sensitivity to curve shape</span></span></td>
<td headers="AUC" class="gt_row gt_left"><span data-qmd-base64="TGVzcyBzZW5zaXRpdmUg4oCUIGN1cnZlcyB3aXRoIGRpZmZlcmVudCBzaGFwZXMgY2FuIHlpZWxkIHNpbWlsYXIgQVVD"><span class="gt_from_md">Less sensitive — curves with different shapes can yield similar AUC</span></span></td>
<td headers="ArcLength" class="gt_row gt_left"><span data-qmd-base64="TW9yZSBzZW5zaXRpdmUg4oCUIGNhcHR1cmVzIHNsb3BlIGNoYW5nZXMsIGN1cnZhdHVyZSwgYW5kIHNtb290aG5lc3MgZGlmZmVyZW5jZXM="><span class="gt_from_md">More sensitive — captures slope changes, curvature, and smoothness differences</span></span></td></tr>
    <tr><td headers="Aspect" class="gt_row gt_left"><span data-qmd-base64="UGFydGlhbCBldmFsdWF0aW9u"><span class="gt_from_md">Partial evaluation</span></span></td>
<td headers="AUC" class="gt_row gt_left"><span data-qmd-base64="UGFydGlhbCBBVUMgcmVxdWlyZXMgbm9ybWFsaXphdGlvbjsgbGVzcyB2aXN1YWxseSBvYnZpb3Vz"><span class="gt_from_md">Partial AUC requires normalization; less visually obvious</span></span></td>
<td headers="ArcLength" class="gt_row gt_left"><span data-qmd-base64="SXQgaXMgZWFzeSB0byBhdm9pZCBwcm9ibGVtYXRpYyByZWdpb25zIGZvciBtb3N0IHJlYXNvbmFibGUgUk9DIGN1cnZlcw=="><span class="gt_from_md">It is easy to avoid problematic regions for most reasonable ROC curves</span></span></td></tr>
    <tr><td headers="Aspect" class="gt_row gt_left"><span data-qmd-base64="Tm9pc2Ugcm9idXN0bmVzcw=="><span class="gt_from_md">Noise robustness</span></span></td>
<td headers="AUC" class="gt_row gt_left"><span data-qmd-base64="UmVsYXRpdmVseSByb2J1c3Q7IGludGVncmF0ZXMgb3ZlciBjdXJ2ZQ=="><span class="gt_from_md">Relatively robust; integrates over curve</span></span></td>
<td headers="ArcLength" class="gt_row gt_left"><span data-qmd-base64="TW9yZSBzZW5zaXRpdmUgdG8gbm9pc2Ugb3IgamFnZ2VkbmVzczsgc21hbGwgb3NjaWxsYXRpb25zIGluZmxhdGUgbGVuZ3Ro"><span class="gt_from_md">More sensitive to noise or jaggedness; small oscillations inflate length</span></span></td></tr>
    <tr><td headers="Aspect" class="gt_row gt_left"><span data-qmd-base64="Q2xpbmljYWwgYWRvcHRpb24="><span class="gt_from_md">Clinical adoption</span></span></td>
<td headers="AUC" class="gt_row gt_left"><span data-qmd-base64="U3RhbmRhcmQgbWV0cmljIHdpdGggZXN0YWJsaXNoZWQgdGhyZXNob2xkcw=="><span class="gt_from_md">Standard metric with established thresholds</span></span></td>
<td headers="ArcLength" class="gt_row gt_left"><span data-qmd-base64="Tm92ZWwgbWV0cmljOyBub3QgeWV0IHdpZGVseSBhZG9wdGVkLCByZXF1aXJlcyBuZXcgYmVuY2htYXJrcw=="><span class="gt_from_md">Novel metric; not yet widely adopted, requires new benchmarks</span></span></td></tr>
    <tr><td headers="Aspect" class="gt_row gt_left"><span data-qmd-base64="VXNlIGNhc2Vz"><span class="gt_from_md">Use cases</span></span></td>
<td headers="AUC" class="gt_row gt_left"><span data-qmd-base64="UmFua2luZyBhY2N1cmFjeSwgb3ZlcmFsbCBkaXNjcmltaW5hdGlvbiBwb3dlcg=="><span class="gt_from_md">Ranking accuracy, overall discrimination power</span></span></td>
<td headers="ArcLength" class="gt_row gt_left"><span data-qmd-base64="RGlhZ25vc3RpYyB0cmFqZWN0b3J5LCBnZW9tZXRyaWMgY29tcGFyaXNvbiwgaGlnaGxpZ2h0aW5nIHJlZ2lvbmFsIHBlcmZvcm1hbmNlIGRpZmZlcmVuY2Vz"><span class="gt_from_md">Diagnostic trajectory, geometric comparison, highlighting regional performance differences</span></span></td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
</section>
</section>
<section id="a-little-calculus-with-roc-curves" class="level2">
<h2 class="anchored" data-anchor-id="a-little-calculus-with-roc-curves">A Little Calculus with ROC curves</h2>
<p>This next plot shows the ROC curves for the three classifiers in the left column and the derivative of TPR with respect to FPR, <span class="math inline">\(d(TPR) / d(FPR)\)</span> in the right hand column for each classifier showing how the slopes of the ROC curves change as FPR increases. Comments in the code provide some details on the hows and whys of building the splines, and the Appendix at the end of the post writes out the equations for the derivatives.</p>
<div class="cell">
<details>
<summary>Show the code for computing slope</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Palette: pastel per model ---</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>model_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Decision Tree"</span>       <span class="ot">=</span> <span class="st">"#F28E8E"</span>,  <span class="co"># pastel red</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Logistic Regression"</span> <span class="ot">=</span> <span class="st">"#8FD19E"</span>,  <span class="co"># pastel green</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SVM"</span>                 <span class="ot">=</span> <span class="st">"#8EB8FF"</span>   <span class="co"># pastel blue</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Clean ROC per group: sort, drop duplicate FPR, enforce monotone TPR ---</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>clean_roc <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(FPR) <span class="sc">%&gt;%</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>(FPR, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">FPR =</span> <span class="fu">pmin</span>(<span class="fu">pmax</span>(FPR, <span class="dv">0</span>), <span class="dv">1</span>),</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">TPR =</span> <span class="fu">pmin</span>(<span class="fu">pmax</span>(<span class="fu">cummax</span>(TPR), <span class="dv">0</span>), <span class="dv">1</span>)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="co"># The goal of make_spline and compute_roc_geometry is to build a spline representation of the ROC curve </span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="co">#   that allows derivatives (first and second) to be computed easily.</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="co">#  splinefun(..., method = "natural") — uses natural cubic splines which are smoother and differentiable up to second order.</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="co"># note that "monoH.FC" splines guarantee monotonicity but can sometimes produce derivative discontinuities or numerical  </span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   instability in higher higher‑order derivatives.</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="co"># The output is a tibble with columns FPR, TPR, dTPR (first derivative), and d2TPR (second derivative) evaluated on a uniform grid of FPR values from 0 to 1.</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Use case: When you need geometry (curvature, slope, phase space analysis) rather than just smoothed ROC points</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Spline builder (use "natural" to avoid strict monotonicity errors) ---</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>make_spline <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">clean_roc</span>(df)</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">splinefun</span>(<span class="at">x =</span> df<span class="sc">$</span>FPR, <span class="at">y =</span> df<span class="sc">$</span>TPR, <span class="at">method =</span> <span class="st">"natural"</span>)</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Geometry over a uniform grid: y, y', y'' ---</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>compute_roc_geometry <span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="at">n_grid =</span> <span class="dv">1001</span>) {</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>  f <span class="ot">&lt;-</span> <span class="fu">make_spline</span>(df)</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>  xg  <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> n_grid)</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>  yg  <span class="ot">&lt;-</span> <span class="fu">f</span>(xg, <span class="at">deriv =</span> <span class="dv">0</span>)</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>  y1g <span class="ot">&lt;-</span> <span class="fu">f</span>(xg, <span class="at">deriv =</span> <span class="dv">1</span>)</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>  y2g <span class="ot">&lt;-</span> <span class="fu">f</span>(xg, <span class="at">deriv =</span> <span class="dv">2</span>)</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">FPR =</span> xg, <span class="at">TPR =</span> yg, <span class="at">dTPR =</span> y1g, <span class="at">d2TPR =</span> y2g)</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Plotters with small text and single-color line per model ---</span></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>plot_roc <span class="ot">&lt;-</span> <span class="cf">function</span>(geom_df, model_label, color_hex) {</span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(geom_df, <span class="fu">aes</span>(<span class="at">x =</span> FPR, <span class="at">y =</span> TPR)) <span class="sc">+</span></span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">color =</span> color_hex, <span class="at">linewidth =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(model_label, <span class="st">"— Smoothed ROC"</span>),</span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"FPR"</span>,</span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"TPR"</span></span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">9</span>) <span class="sc">+</span></span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text  =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>plot_derivative <span class="ot">&lt;-</span> <span class="cf">function</span>(geom_df, model_label, color_hex) {</span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(geom_df, <span class="fu">aes</span>(<span class="at">x =</span> FPR, <span class="at">y =</span> dTPR)) <span class="sc">+</span></span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"grey80"</span>) <span class="sc">+</span></span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">color =</span> color_hex, <span class="at">linewidth =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(model_label, <span class="st">"— dTPR/dFPR vs FPR"</span>),</span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"FPR"</span>,</span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"dTPR/dFPR"</span></span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">9</span>) <span class="sc">+</span></span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text  =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb14-80"><a href="#cb14-80" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-81"><a href="#cb14-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-82"><a href="#cb14-82" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Main: build 3x2 grid with ROC on the LEFT, derivative on the RIGHT ---</span></span>
<span id="cb14-83"><a href="#cb14-83" aria-hidden="true" tabindex="-1"></a>plot_roc_geometry_grid <span class="ot">&lt;-</span> <span class="cf">function</span>(smooth_results, <span class="at">n_grid =</span> <span class="dv">1001</span>) {</span>
<span id="cb14-84"><a href="#cb14-84" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ensure intended order of rows</span></span>
<span id="cb14-85"><a href="#cb14-85" aria-hidden="true" tabindex="-1"></a>  model_order <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Decision Tree"</span>, <span class="st">"Logistic Regression"</span>, <span class="st">"SVM"</span>)</span>
<span id="cb14-86"><a href="#cb14-86" aria-hidden="true" tabindex="-1"></a>  models <span class="ot">&lt;-</span> <span class="fu">intersect</span>(model_order, <span class="fu">unique</span>(smooth_results<span class="sc">$</span>model_norm))</span>
<span id="cb14-87"><a href="#cb14-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">length</span>(models) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb14-88"><a href="#cb14-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-89"><a href="#cb14-89" aria-hidden="true" tabindex="-1"></a>  rows <span class="ot">&lt;-</span> <span class="fu">map</span>(models, <span class="cf">function</span>(m) {</span>
<span id="cb14-90"><a href="#cb14-90" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> smooth_results <span class="sc">%&gt;%</span> <span class="fu">filter</span>(model_norm <span class="sc">==</span> m)</span>
<span id="cb14-91"><a href="#cb14-91" aria-hidden="true" tabindex="-1"></a>    geom_df <span class="ot">&lt;-</span> <span class="fu">compute_roc_geometry</span>(df, n_grid)</span>
<span id="cb14-92"><a href="#cb14-92" aria-hidden="true" tabindex="-1"></a>    col_hex <span class="ot">&lt;-</span> model_colors[[m]]</span>
<span id="cb14-93"><a href="#cb14-93" aria-hidden="true" tabindex="-1"></a>    p_left  <span class="ot">&lt;-</span> <span class="fu">plot_roc</span>(geom_df, m, col_hex)</span>
<span id="cb14-94"><a href="#cb14-94" aria-hidden="true" tabindex="-1"></a>    p_right <span class="ot">&lt;-</span> <span class="fu">plot_derivative</span>(geom_df, m, col_hex)</span>
<span id="cb14-95"><a href="#cb14-95" aria-hidden="true" tabindex="-1"></a>    p_left <span class="sc">|</span> p_right</span>
<span id="cb14-96"><a href="#cb14-96" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb14-97"><a href="#cb14-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-98"><a href="#cb14-98" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Stack rows into 3x2 (or as many as available)</span></span>
<span id="cb14-99"><a href="#cb14-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reduce</span>(rows, <span class="st">`</span><span class="at">/</span><span class="st">`</span>)</span>
<span id="cb14-100"><a href="#cb14-100" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-101"><a href="#cb14-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-102"><a href="#cb14-102" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Usage ---</span></span>
<span id="cb14-103"><a href="#cb14-103" aria-hidden="true" tabindex="-1"></a><span class="co"># smooth_results must have columns: model_norm, FPR, TPR</span></span>
<span id="cb14-104"><a href="#cb14-104" aria-hidden="true" tabindex="-1"></a>grid_plot <span class="ot">&lt;-</span> <span class="fu">plot_roc_geometry_grid</span>(smooth_results, <span class="at">n_grid =</span> <span class="dv">2001</span>)</span>
<span id="cb14-105"><a href="#cb14-105" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(grid_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Arclength_Post_v6_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>It a well known result from mathematical statistics, not usually emphasized in a machine learning context, that the slope of the tangent to the ROC curve at any point is equal to the the instantaneous likelihood ratio at that point. <a href="https://academic.oup.com/aje/article-abstract/148/11/1127/123231?redirectedFrom=PDF">Choi (1998)</a>. This is exactly what is plotted in the second column. However, to understand the connection with differential geometry, the following section of code rederives the plot by considering ROC curves parameterized by threshold <span class="math inline">\(t \in [0,1]\)</span> so the curve is the set of points <span class="math inline">\((FPR(t),TPR(t))\)</span>. This point of view is preferred for analyzing likelihood ratios and connecting with diagnostic test theory. In both cases the likelihood ratio is identical since likelihood is a property of the curve and <span class="math inline">\(\frac{d(TPR)}{d(FPR)} = \frac{d(TPR)/dt))}{d(FPR)/dt}\)</span></p>
<div class="cell">
<details>
<summary>Show the code for parameterized ROC curves</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Pastel palette per model ---</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>model_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Decision Tree"</span>       <span class="ot">=</span> <span class="st">"#F28E8E"</span>,  <span class="co"># pastel red</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Logistic Regression"</span> <span class="ot">=</span> <span class="st">"#8FD19E"</span>,  <span class="co"># pastel green</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SVM"</span>                 <span class="ot">=</span> <span class="st">"#8EB8FF"</span>   <span class="co"># pastel blue</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Ensure threshold column exists ---</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>add_threshold <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(model_norm) <span class="sc">%&gt;%</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">threshold =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> <span class="fu">n</span>())) <span class="sc">%&gt;%</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Clean ROC per group ---</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>clean_roc <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(threshold) <span class="sc">%&gt;%</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>(threshold, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">FPR =</span> <span class="fu">pmin</span>(<span class="fu">pmax</span>(FPR, <span class="dv">0</span>), <span class="dv">1</span>),</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">TPR =</span> <span class="fu">pmin</span>(<span class="fu">pmax</span>(TPR, <span class="dv">0</span>), <span class="dv">1</span>)</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Spline builders for parametric ROC (FPR(t), TPR(t)) ---</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>make_spline_pair <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">clean_roc</span>(df)</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>  f_fpr <span class="ot">&lt;-</span> <span class="fu">splinefun</span>(<span class="at">x =</span> df<span class="sc">$</span>threshold, <span class="at">y =</span> df<span class="sc">$</span>FPR, <span class="at">method =</span> <span class="st">"natural"</span>)</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>  f_tpr <span class="ot">&lt;-</span> <span class="fu">splinefun</span>(<span class="at">x =</span> df<span class="sc">$</span>threshold, <span class="at">y =</span> df<span class="sc">$</span>TPR, <span class="at">method =</span> <span class="st">"natural"</span>)</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">f_fpr =</span> f_fpr, <span class="at">f_tpr =</span> f_tpr)</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Compute ROC geometry with respect to threshold t ---</span></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>compute_roc_geometry <span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="at">n_grid =</span> <span class="dv">1001</span>) {</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>  spl <span class="ot">&lt;-</span> <span class="fu">make_spline_pair</span>(df)</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>  f_fpr <span class="ot">&lt;-</span> spl<span class="sc">$</span>f_fpr</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>  f_tpr <span class="ot">&lt;-</span> spl<span class="sc">$</span>f_tpr</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>  tg <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(df<span class="sc">$</span>threshold), <span class="fu">max</span>(df<span class="sc">$</span>threshold), <span class="at">length.out =</span> n_grid)</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>  x   <span class="ot">&lt;-</span> <span class="fu">f_fpr</span>(tg, <span class="at">deriv =</span> <span class="dv">0</span>)   <span class="co"># FPR(t)</span></span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>  y   <span class="ot">&lt;-</span> <span class="fu">f_tpr</span>(tg, <span class="at">deriv =</span> <span class="dv">0</span>)   <span class="co"># TPR(t)</span></span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>  x1  <span class="ot">&lt;-</span> <span class="fu">f_fpr</span>(tg, <span class="at">deriv =</span> <span class="dv">1</span>)   <span class="co"># dFPR/dt</span></span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>  y1  <span class="ot">&lt;-</span> <span class="fu">f_tpr</span>(tg, <span class="at">deriv =</span> <span class="dv">1</span>)   <span class="co"># dTPR/dt</span></span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># slope of ROC curve = dTPR/dFPR = (dTPR/dt) / (dFPR/dt)</span></span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>  slope <span class="ot">&lt;-</span> y1 <span class="sc">/</span> x1</span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">threshold =</span> tg,</span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">FPR =</span> x,</span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">TPR =</span> y,</span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">dFPR_dt =</span> x1,</span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">dTPR_dt =</span> y1,</span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">slope_dTPR_dFPR =</span> slope</span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Build combined data frame for all models ---</span></span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a>make_derivative_df <span class="ot">&lt;-</span> <span class="cf">function</span>(smooth_results, <span class="at">n_grid =</span> <span class="dv">1001</span>) {</span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a>  smooth_results <span class="ot">&lt;-</span> <span class="fu">add_threshold</span>(smooth_results)</span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a>  model_order <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Decision Tree"</span>, <span class="st">"Logistic Regression"</span>, <span class="st">"SVM"</span>)</span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a>  models <span class="ot">&lt;-</span> <span class="fu">intersect</span>(model_order, <span class="fu">unique</span>(smooth_results<span class="sc">$</span>model_norm))</span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-68"><a href="#cb15-68" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(models, <span class="cf">function</span>(m) {</span>
<span id="cb15-69"><a href="#cb15-69" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> smooth_results <span class="sc">%&gt;%</span> <span class="fu">filter</span>(model_norm <span class="sc">==</span> m)</span>
<span id="cb15-70"><a href="#cb15-70" aria-hidden="true" tabindex="-1"></a>    geom_df <span class="ot">&lt;-</span> <span class="fu">compute_roc_geometry</span>(df, n_grid)</span>
<span id="cb15-71"><a href="#cb15-71" aria-hidden="true" tabindex="-1"></a>    geom_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">model =</span> m)</span>
<span id="cb15-72"><a href="#cb15-72" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb15-73"><a href="#cb15-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-74"><a href="#cb15-74" aria-hidden="true" tabindex="-1"></a>  results</span>
<span id="cb15-75"><a href="#cb15-75" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-76"><a href="#cb15-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-77"><a href="#cb15-77" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Plotters ---</span></span>
<span id="cb15-78"><a href="#cb15-78" aria-hidden="true" tabindex="-1"></a>plot_curvature <span class="ot">&lt;-</span> <span class="cf">function</span>(geom_df, model_label, color_hex) {</span>
<span id="cb15-79"><a href="#cb15-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(geom_df, <span class="fu">aes</span>(<span class="at">x =</span> threshold, <span class="at">y =</span> TPR)) <span class="sc">+</span></span>
<span id="cb15-80"><a href="#cb15-80" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">color =</span> color_hex, <span class="at">linewidth =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb15-81"><a href="#cb15-81" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(model_label, <span class="st">"— ROC curve TPR(t)"</span>),</span>
<span id="cb15-82"><a href="#cb15-82" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Threshold"</span>, <span class="at">y =</span> <span class="st">"TPR"</span>) <span class="sc">+</span></span>
<span id="cb15-83"><a href="#cb15-83" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">9</span>) <span class="sc">+</span></span>
<span id="cb15-84"><a href="#cb15-84" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb15-85"><a href="#cb15-85" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb15-86"><a href="#cb15-86" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text  =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb15-87"><a href="#cb15-87" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())</span>
<span id="cb15-88"><a href="#cb15-88" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-89"><a href="#cb15-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-90"><a href="#cb15-90" aria-hidden="true" tabindex="-1"></a>plot_slope <span class="ot">&lt;-</span> <span class="cf">function</span>(geom_df, model_label, color_hex) {</span>
<span id="cb15-91"><a href="#cb15-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(geom_df, <span class="fu">aes</span>(<span class="at">x =</span> threshold, <span class="at">y =</span> slope_dTPR_dFPR)) <span class="sc">+</span></span>
<span id="cb15-92"><a href="#cb15-92" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"grey80"</span>) <span class="sc">+</span></span>
<span id="cb15-93"><a href="#cb15-93" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">color =</span> color_hex, <span class="at">linewidth =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb15-94"><a href="#cb15-94" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(model_label, <span class="st">"— dTPR/dFPR (Likelihood Ratio)"</span>),</span>
<span id="cb15-95"><a href="#cb15-95" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Threshold"</span>, <span class="at">y =</span> <span class="st">"dTPR/dFPR"</span>) <span class="sc">+</span></span>
<span id="cb15-96"><a href="#cb15-96" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">9</span>) <span class="sc">+</span></span>
<span id="cb15-97"><a href="#cb15-97" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb15-98"><a href="#cb15-98" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb15-99"><a href="#cb15-99" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text  =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb15-100"><a href="#cb15-100" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())</span>
<span id="cb15-101"><a href="#cb15-101" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-102"><a href="#cb15-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-103"><a href="#cb15-103" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Main: build 3x2 grid (ROC curve | slope dTPR/dFPR) ---</span></span>
<span id="cb15-104"><a href="#cb15-104" aria-hidden="true" tabindex="-1"></a>plot_roc_geometry_grid <span class="ot">&lt;-</span> <span class="cf">function</span>(smooth_results, <span class="at">n_grid =</span> <span class="dv">1001</span>) {</span>
<span id="cb15-105"><a href="#cb15-105" aria-hidden="true" tabindex="-1"></a>  smooth_results <span class="ot">&lt;-</span> <span class="fu">add_threshold</span>(smooth_results)</span>
<span id="cb15-106"><a href="#cb15-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-107"><a href="#cb15-107" aria-hidden="true" tabindex="-1"></a>  model_order <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Decision Tree"</span>, <span class="st">"Logistic Regression"</span>, <span class="st">"SVM"</span>)</span>
<span id="cb15-108"><a href="#cb15-108" aria-hidden="true" tabindex="-1"></a>  models <span class="ot">&lt;-</span> <span class="fu">intersect</span>(model_order, <span class="fu">unique</span>(smooth_results<span class="sc">$</span>model_norm))</span>
<span id="cb15-109"><a href="#cb15-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">length</span>(models) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb15-110"><a href="#cb15-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-111"><a href="#cb15-111" aria-hidden="true" tabindex="-1"></a>  rows <span class="ot">&lt;-</span> <span class="fu">map</span>(models, <span class="cf">function</span>(m) {</span>
<span id="cb15-112"><a href="#cb15-112" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> smooth_results <span class="sc">%&gt;%</span> <span class="fu">filter</span>(model_norm <span class="sc">==</span> m)</span>
<span id="cb15-113"><a href="#cb15-113" aria-hidden="true" tabindex="-1"></a>    geom_df <span class="ot">&lt;-</span> <span class="fu">compute_roc_geometry</span>(df, n_grid)</span>
<span id="cb15-114"><a href="#cb15-114" aria-hidden="true" tabindex="-1"></a>    col_hex <span class="ot">&lt;-</span> model_colors[[m]]</span>
<span id="cb15-115"><a href="#cb15-115" aria-hidden="true" tabindex="-1"></a>    p_left  <span class="ot">&lt;-</span> <span class="fu">plot_curvature</span>(geom_df, m, col_hex)</span>
<span id="cb15-116"><a href="#cb15-116" aria-hidden="true" tabindex="-1"></a>    p_right <span class="ot">&lt;-</span> <span class="fu">plot_slope</span>(geom_df, m, col_hex)</span>
<span id="cb15-117"><a href="#cb15-117" aria-hidden="true" tabindex="-1"></a>    patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(p_left, p_right, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb15-118"><a href="#cb15-118" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb15-119"><a href="#cb15-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-120"><a href="#cb15-120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reduce</span>(rows, <span class="st">`</span><span class="at">/</span><span class="st">`</span>)</span>
<span id="cb15-121"><a href="#cb15-121" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-122"><a href="#cb15-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-123"><a href="#cb15-123" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Usage ---</span></span>
<span id="cb15-124"><a href="#cb15-124" aria-hidden="true" tabindex="-1"></a>derivative_df <span class="ot">&lt;-</span> <span class="fu">make_derivative_df</span>(smooth_results, <span class="at">n_grid =</span> <span class="dv">2001</span>)</span>
<span id="cb15-125"><a href="#cb15-125" aria-hidden="true" tabindex="-1"></a>grid_plot <span class="ot">&lt;-</span> <span class="fu">plot_roc_geometry_grid</span>(smooth_results, <span class="at">n_grid =</span> <span class="dv">2001</span>)</span>
<span id="cb15-126"><a href="#cb15-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-127"><a href="#cb15-127" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(grid_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Arclength_Post_v6_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Show the code for parameterized ROC curves</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#head(derivative_df)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The plot above shows the Likelihood ratios as a function of threshold for each of the three models. These values are stored in <code>slope_DTPR_dFPR</code> column of the <code>derivative_df</code> data frame. The following code extracts the maximum positive likelihood ratio and minimum negative likelihood ratio for each model. It follows Choi (1998) where he suggests comparing LR values to decision thresholds that are convenient for diagnostic testing:</p>
<ul>
<li>LR+ (positive test): slope of the operating point where TPR is high and FPR is low (upper left of ROC curve)</li>
<li>LR- negative test: slope of the operating point where TPR is low and FPR is high (lower right of ROC curve)</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>derivative_df <span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(model) <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_LR_plus =</span> <span class="fu">max</span>(slope_dTPR_dFPR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_LR_minus =</span> <span class="fu">min</span>(slope_dTPR_dFPR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  model               max_LR_plus min_LR_minus
  &lt;chr&gt;                     &lt;dbl&gt;        &lt;dbl&gt;
1 Decision Tree              2.21   -0.0000530
2 Logistic Regression        7.64   -0.0203   
3 SVM                        3.87   -0.00814  </code></pre>
</div>
</div>
<p>A standard interpretation for a diagnostic test is that LR+ values above 10 are considered strong evidence to rule in a condition while LR- values below 0.1 are considered strong evidence to rule out a condition.</p>
</section>
<section id="curvature" class="level2">
<h2 class="anchored" data-anchor-id="curvature">Curvature</h2>
<p>Our final topic will be to take a brief look at curvature. The curvature, <span class="math inline">\(\kappa(t)\)</span> of a two dimensional planer curve, like an ROC curve, measures how sharply the curve bends at a given threshold, <span class="math inline">\(t\)</span>. Computing it involves computing second derivatives as the equations in the Appendix show. High curvature implies rapidly changing slope while low curvature indicates that slope is changing slowly. The derivative of curvature (a third derivative) indicates how fast the changing slope itself is changing. Large positive values of <span class="math inline">\(d\kappa(t)/dt\)</span> can indicate threshold zone where small changes in the decision rule can produce large changes in discrimination. Large negative values of <span class="math inline">\(d\kappa(t)/dt\)</span> can indicate zones where slope changes are stabilizing suggesting diminishing returns for tightening or loosening the decision rules. Zones with values near zero indicate regions that are relatively stable with respect of threshold. The following code calculates <span class="math inline">\(\kappa(t)\)</span> and <span class="math inline">\(d\kappa(t)/dt\)</span> for each of the three models and plots them side by side.</p>
<p>These ideas my be helpful in understanding the tradeoffs involved is selecting a threshold for a particular applicature.</p>
<div class="cell">
<details>
<summary>Code for curvature plots</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Pastel palette per model ---</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>model_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Decision Tree"</span>       <span class="ot">=</span> <span class="st">"#F28E8E"</span>,  <span class="co"># pastel red</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Logistic Regression"</span> <span class="ot">=</span> <span class="st">"#8FD19E"</span>,  <span class="co"># pastel green</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SVM"</span>                 <span class="ot">=</span> <span class="st">"#8EB8FF"</span>   <span class="co"># pastel blue</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Ensure threshold column exists ---</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co"># If smooth_results has only FPR/TPR, add a synthetic threshold</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>add_threshold <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(model_norm) <span class="sc">%&gt;%</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">threshold =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> <span class="fu">n</span>())) <span class="sc">%&gt;%</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Clean ROC per group ---</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>clean_roc <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(threshold) <span class="sc">%&gt;%</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>(threshold, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">FPR =</span> <span class="fu">pmin</span>(<span class="fu">pmax</span>(FPR, <span class="dv">0</span>), <span class="dv">1</span>),</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">TPR =</span> <span class="fu">pmin</span>(<span class="fu">pmax</span>(TPR, <span class="dv">0</span>), <span class="dv">1</span>)</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Spline builders for parametric ROC (FPR(t), TPR(t)) ---</span></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>make_spline_pair <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">clean_roc</span>(df)</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>  f_fpr <span class="ot">&lt;-</span> <span class="fu">splinefun</span>(<span class="at">x =</span> df<span class="sc">$</span>threshold, <span class="at">y =</span> df<span class="sc">$</span>FPR, <span class="at">method =</span> <span class="st">"natural"</span>)</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>  f_tpr <span class="ot">&lt;-</span> <span class="fu">splinefun</span>(<span class="at">x =</span> df<span class="sc">$</span>threshold, <span class="at">y =</span> df<span class="sc">$</span>TPR, <span class="at">method =</span> <span class="st">"natural"</span>)</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">f_fpr =</span> f_fpr, <span class="at">f_tpr =</span> f_tpr)</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Compute ROC geometry with respect to threshold t ---</span></span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>compute_roc_geometry <span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="at">n_grid =</span> <span class="dv">1001</span>) {</span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>  spl <span class="ot">&lt;-</span> <span class="fu">make_spline_pair</span>(df)</span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>  f_fpr <span class="ot">&lt;-</span> spl<span class="sc">$</span>f_fpr</span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>  f_tpr <span class="ot">&lt;-</span> spl<span class="sc">$</span>f_tpr</span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>  tg <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(df<span class="sc">$</span>threshold), <span class="fu">max</span>(df<span class="sc">$</span>threshold), <span class="at">length.out =</span> n_grid)</span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>  x   <span class="ot">&lt;-</span> <span class="fu">f_fpr</span>(tg, <span class="at">deriv =</span> <span class="dv">0</span>)</span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>  y   <span class="ot">&lt;-</span> <span class="fu">f_tpr</span>(tg, <span class="at">deriv =</span> <span class="dv">0</span>)</span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>  x1  <span class="ot">&lt;-</span> <span class="fu">f_fpr</span>(tg, <span class="at">deriv =</span> <span class="dv">1</span>)</span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>  y1  <span class="ot">&lt;-</span> <span class="fu">f_tpr</span>(tg, <span class="at">deriv =</span> <span class="dv">1</span>)</span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a>  x2  <span class="ot">&lt;-</span> <span class="fu">f_fpr</span>(tg, <span class="at">deriv =</span> <span class="dv">2</span>)</span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a>  y2  <span class="ot">&lt;-</span> <span class="fu">f_tpr</span>(tg, <span class="at">deriv =</span> <span class="dv">2</span>)</span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a>  x3  <span class="ot">&lt;-</span> <span class="fu">f_fpr</span>(tg, <span class="at">deriv =</span> <span class="dv">3</span>)</span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a>  y3  <span class="ot">&lt;-</span> <span class="fu">f_tpr</span>(tg, <span class="at">deriv =</span> <span class="dv">3</span>)</span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a>  <span class="co"># curvature κ(t)</span></span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a>  num   <span class="ot">&lt;-</span> x1 <span class="sc">*</span> y2 <span class="sc">-</span> y1 <span class="sc">*</span> x2</span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a>  denom <span class="ot">&lt;-</span> (x1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> y1<span class="sc">^</span><span class="dv">2</span>)<span class="sc">^</span>(<span class="dv">3</span><span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a>  kappa <span class="ot">&lt;-</span> <span class="fu">abs</span>(num) <span class="sc">/</span> denom</span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a>  <span class="co"># derivative of curvature wrt t</span></span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a>  dnum   <span class="ot">&lt;-</span> x1 <span class="sc">*</span> y3 <span class="sc">-</span> y1 <span class="sc">*</span> x3 <span class="sc">+</span> x2 <span class="sc">*</span> y2 <span class="sc">-</span> y2 <span class="sc">*</span> x2</span>
<span id="cb19-60"><a href="#cb19-60" aria-hidden="true" tabindex="-1"></a>  ddenom <span class="ot">&lt;-</span> (<span class="dv">3</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">*</span> (x1<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> y1<span class="sc">^</span><span class="dv">2</span>)<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">*</span> (<span class="dv">2</span><span class="sc">*</span>x1<span class="sc">*</span>x2 <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>y1<span class="sc">*</span>y2)</span>
<span id="cb19-61"><a href="#cb19-61" aria-hidden="true" tabindex="-1"></a>  dkappa_dt <span class="ot">&lt;-</span> (dnum <span class="sc">*</span> denom <span class="sc">-</span> num <span class="sc">*</span> ddenom) <span class="sc">/</span> (denom<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb19-62"><a href="#cb19-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-63"><a href="#cb19-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb19-64"><a href="#cb19-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">threshold =</span> tg,</span>
<span id="cb19-65"><a href="#cb19-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">FPR =</span> x,</span>
<span id="cb19-66"><a href="#cb19-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">TPR =</span> y,</span>
<span id="cb19-67"><a href="#cb19-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">dFPR_dt =</span> x1,</span>
<span id="cb19-68"><a href="#cb19-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">dTPR_dt =</span> y1,</span>
<span id="cb19-69"><a href="#cb19-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">kappa =</span> kappa,</span>
<span id="cb19-70"><a href="#cb19-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">dkappa_dt =</span> dkappa_dt</span>
<span id="cb19-71"><a href="#cb19-71" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-72"><a href="#cb19-72" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-73"><a href="#cb19-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-74"><a href="#cb19-74" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Build combined data frame for all models ---</span></span>
<span id="cb19-75"><a href="#cb19-75" aria-hidden="true" tabindex="-1"></a>make_derivative_df <span class="ot">&lt;-</span> <span class="cf">function</span>(smooth_results, <span class="at">n_grid =</span> <span class="dv">1001</span>) {</span>
<span id="cb19-76"><a href="#cb19-76" aria-hidden="true" tabindex="-1"></a>  smooth_results <span class="ot">&lt;-</span> <span class="fu">add_threshold</span>(smooth_results)</span>
<span id="cb19-77"><a href="#cb19-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-78"><a href="#cb19-78" aria-hidden="true" tabindex="-1"></a>  model_order <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Decision Tree"</span>, <span class="st">"Logistic Regression"</span>, <span class="st">"SVM"</span>)</span>
<span id="cb19-79"><a href="#cb19-79" aria-hidden="true" tabindex="-1"></a>  models <span class="ot">&lt;-</span> <span class="fu">intersect</span>(model_order, <span class="fu">unique</span>(smooth_results<span class="sc">$</span>model_norm))</span>
<span id="cb19-80"><a href="#cb19-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-81"><a href="#cb19-81" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(models, <span class="cf">function</span>(m) {</span>
<span id="cb19-82"><a href="#cb19-82" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> smooth_results <span class="sc">%&gt;%</span> <span class="fu">filter</span>(model_norm <span class="sc">==</span> m)</span>
<span id="cb19-83"><a href="#cb19-83" aria-hidden="true" tabindex="-1"></a>    geom_df <span class="ot">&lt;-</span> <span class="fu">compute_roc_geometry</span>(df, n_grid)</span>
<span id="cb19-84"><a href="#cb19-84" aria-hidden="true" tabindex="-1"></a>    geom_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">model =</span> m)</span>
<span id="cb19-85"><a href="#cb19-85" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb19-86"><a href="#cb19-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-87"><a href="#cb19-87" aria-hidden="true" tabindex="-1"></a>  results</span>
<span id="cb19-88"><a href="#cb19-88" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-89"><a href="#cb19-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-90"><a href="#cb19-90" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Plotters ---</span></span>
<span id="cb19-91"><a href="#cb19-91" aria-hidden="true" tabindex="-1"></a>plot_curvature <span class="ot">&lt;-</span> <span class="cf">function</span>(geom_df, model_label, color_hex) {</span>
<span id="cb19-92"><a href="#cb19-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(geom_df, <span class="fu">aes</span>(<span class="at">x =</span> threshold, <span class="at">y =</span> kappa)) <span class="sc">+</span></span>
<span id="cb19-93"><a href="#cb19-93" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">color =</span> color_hex, <span class="at">linewidth =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb19-94"><a href="#cb19-94" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(model_label, <span class="st">"— curvature κ(t)"</span>),</span>
<span id="cb19-95"><a href="#cb19-95" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Threshold"</span>, <span class="at">y =</span> <span class="st">"κ(t)"</span>) <span class="sc">+</span></span>
<span id="cb19-96"><a href="#cb19-96" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">9</span>) <span class="sc">+</span></span>
<span id="cb19-97"><a href="#cb19-97" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb19-98"><a href="#cb19-98" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb19-99"><a href="#cb19-99" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text  =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb19-100"><a href="#cb19-100" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())</span>
<span id="cb19-101"><a href="#cb19-101" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-102"><a href="#cb19-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-103"><a href="#cb19-103" aria-hidden="true" tabindex="-1"></a>plot_dcurvature <span class="ot">&lt;-</span> <span class="cf">function</span>(geom_df, model_label, color_hex) {</span>
<span id="cb19-104"><a href="#cb19-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(geom_df, <span class="fu">aes</span>(<span class="at">x =</span> threshold, <span class="at">y =</span> dkappa_dt)) <span class="sc">+</span></span>
<span id="cb19-105"><a href="#cb19-105" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"grey80"</span>) <span class="sc">+</span></span>
<span id="cb19-106"><a href="#cb19-106" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">color =</span> color_hex, <span class="at">linewidth =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb19-107"><a href="#cb19-107" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(model_label, <span class="st">"— dκ/dt"</span>),</span>
<span id="cb19-108"><a href="#cb19-108" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Threshold"</span>, <span class="at">y =</span> <span class="st">"dκ/dt"</span>) <span class="sc">+</span></span>
<span id="cb19-109"><a href="#cb19-109" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">9</span>) <span class="sc">+</span></span>
<span id="cb19-110"><a href="#cb19-110" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb19-111"><a href="#cb19-111" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb19-112"><a href="#cb19-112" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text  =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb19-113"><a href="#cb19-113" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())</span>
<span id="cb19-114"><a href="#cb19-114" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-115"><a href="#cb19-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-116"><a href="#cb19-116" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Main: build 3x2 grid (curvature | dκ/dt) ---</span></span>
<span id="cb19-117"><a href="#cb19-117" aria-hidden="true" tabindex="-1"></a>plot_roc_geometry_grid <span class="ot">&lt;-</span> <span class="cf">function</span>(smooth_results, <span class="at">n_grid =</span> <span class="dv">1001</span>) {</span>
<span id="cb19-118"><a href="#cb19-118" aria-hidden="true" tabindex="-1"></a>  smooth_results <span class="ot">&lt;-</span> <span class="fu">add_threshold</span>(smooth_results)</span>
<span id="cb19-119"><a href="#cb19-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-120"><a href="#cb19-120" aria-hidden="true" tabindex="-1"></a>  model_order <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Decision Tree"</span>, <span class="st">"Logistic Regression"</span>, <span class="st">"SVM"</span>)</span>
<span id="cb19-121"><a href="#cb19-121" aria-hidden="true" tabindex="-1"></a>  models <span class="ot">&lt;-</span> <span class="fu">intersect</span>(model_order, <span class="fu">unique</span>(smooth_results<span class="sc">$</span>model_norm))</span>
<span id="cb19-122"><a href="#cb19-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">length</span>(models) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb19-123"><a href="#cb19-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-124"><a href="#cb19-124" aria-hidden="true" tabindex="-1"></a>  rows <span class="ot">&lt;-</span> <span class="fu">map</span>(models, <span class="cf">function</span>(m) {</span>
<span id="cb19-125"><a href="#cb19-125" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> smooth_results <span class="sc">%&gt;%</span> <span class="fu">filter</span>(model_norm <span class="sc">==</span> m)</span>
<span id="cb19-126"><a href="#cb19-126" aria-hidden="true" tabindex="-1"></a>    geom_df <span class="ot">&lt;-</span> <span class="fu">compute_roc_geometry</span>(df, n_grid)</span>
<span id="cb19-127"><a href="#cb19-127" aria-hidden="true" tabindex="-1"></a>    col_hex <span class="ot">&lt;-</span> model_colors[[m]]</span>
<span id="cb19-128"><a href="#cb19-128" aria-hidden="true" tabindex="-1"></a>    p_left  <span class="ot">&lt;-</span> <span class="fu">plot_curvature</span>(geom_df, m, col_hex)</span>
<span id="cb19-129"><a href="#cb19-129" aria-hidden="true" tabindex="-1"></a>    p_right <span class="ot">&lt;-</span> <span class="fu">plot_dcurvature</span>(geom_df, m, col_hex)</span>
<span id="cb19-130"><a href="#cb19-130" aria-hidden="true" tabindex="-1"></a>    patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(p_left, p_right, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb19-131"><a href="#cb19-131" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb19-132"><a href="#cb19-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-133"><a href="#cb19-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reduce</span>(rows, <span class="st">`</span><span class="at">/</span><span class="st">`</span>)</span>
<span id="cb19-134"><a href="#cb19-134" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-135"><a href="#cb19-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-136"><a href="#cb19-136" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Usage ---</span></span>
<span id="cb19-137"><a href="#cb19-137" aria-hidden="true" tabindex="-1"></a>derivative_df <span class="ot">&lt;-</span> <span class="fu">make_derivative_df</span>(smooth_results, <span class="at">n_grid =</span> <span class="dv">2001</span>)</span>
<span id="cb19-138"><a href="#cb19-138" aria-hidden="true" tabindex="-1"></a><span class="co">#head(derivative_df)</span></span>
<span id="cb19-139"><a href="#cb19-139" aria-hidden="true" tabindex="-1"></a>grid_plot <span class="ot">&lt;-</span> <span class="fu">plot_roc_geometry_grid</span>(smooth_results, <span class="at">n_grid =</span> <span class="dv">2001</span>)</span>
<span id="cb19-140"><a href="#cb19-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-141"><a href="#cb19-141" aria-hidden="true" tabindex="-1"></a>grid_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Arclength_Post_v6_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Using curvature in ROC studies is a relatively new idea. However, it seems to be an idea that holds some promise. In their 2022 paper <a href="https://academic.oup.com/bioinformatics/article/38/24/5390/6769888?login=false">Definign the extent of gene function using ROC curvature</a> Fischer and Gillis introduction as a method to evaluate gene function prediction. They write: &gt; We identify Functional Equivalence Classes (FECs), subsets of annotated and unannotated genes that jointly drive performance, by assessing the presence of straight lines in ROC curves built from gene-centric prediction tasks, such as function or interaction predictions.</p>
<p>Maybe in genomics, the curvature of ROC curves will point to the shape of things to come.</p>
</section>
<section id="appendix" class="level2">
<h2 class="anchored" data-anchor-id="appendix">Appendix</h2>
<p>Here are the equations for the some of derivatives implemented in the code above.</p>
<p><span class="math inline">\(y'(x) = \frac{d\,\text{TPR}}{d\,\text{FPR}}\)</span></p>
<p><span class="math inline">\(y'(x) = \frac{d\,\text{TPR}}{d\,\text{FPR}}\)</span></p>
<p><span class="math inline">\(y''(x) = \frac{d^2\,\text{TPR}}{d\,\text{FPR}^2}\)</span></p>
<p><span class="math inline">\(y'''(x) = \frac{d^3\,\text{TPR}}{d\,\text{FPR}^3}\)</span></p>
<p><span class="math inline">\(\kappa(x) = \frac{|y''(x)|}{\left(1 + \left[y'(x)\right]^2\right)^{3/2}}\)</span></p>
<p><span class="math inline">\(\frac{d\kappa}{dx} = \frac{y'''(x)\,\left(1 + \left[y'(x)\right]^2\right) - 3\,y'(x)\,\left(y''(x)\right)^2}{\left(1 + \left[y'(x)\right]^2\right)^{5/2}}\)</span></p>
<p><span class="math inline">\(x'(t) = \frac{dx}{dt}, \quad y'(t) = \frac{dy}{dt}\)</span></p>
<p><span class="math inline">\(x''(t) = \frac{d^2x}{dt^2}, \quad y''(t) = \frac{d^2y}{dt^2}\)</span></p>
<p><span class="math inline">\(\kappa(t) = \frac{\left|\,x'(t)\,y''(t) - y'(t)\,x''(t)\,\right|}{\big(x'(t)^2 + y'(t)^2\big)^{3/2}}\)</span></p>
<p><span class="math inline">\(\frac{d\kappa}{dt} = \operatorname{sgn}\!\big(x'(t) y''(t) - y'(t) x''(t))\big)\cdot\)</span> <span class="math inline">\(\frac{\Big(x'(t) y^{(3)}(t) - y'(t) x^{(3)}(t) + x''(t) y''(t) - y''(t) x''(t)\Big)\,(x'(t)^2 + y'(t)^2)^{3/2} - \big(x'(t) y''(t) - y'(t) x''(t)\big)\,\tfrac{3}{2}(x'(t)^2 + y'(t)^2)^{1/2}\,(2x'(t)x''(t) + 2y'(t)y''(t))}{\big(x'(t)^2 + y'(t)^2\big)^3}\)</span></p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>